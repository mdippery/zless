[tox]
envlist = cov-init,py3{10,9,8},cov-report
toxworkdir = /tmp/tox_zless
isolated_build = true

[testenv]
setenv =
  COVERAGE_FILE = tests/coverage/coverage.{envname}
whitelist_externals = poetry
commands =
  poetry install -v
  poetry run coverage run --source=zless -m py.test {posargs}

[testenv:cov-init]
skip_install = true
deps = coverage[toml]
setenv =
  COVERAGE_FILE = tests/coverage/coverage
whitelist_externals = mkdir
commands =
  coverage erase

[testenv:cov-report]
skip_install = true
deps = coverage[toml]
setenv =
  COVERAGE_FILE = tests/coverage/coverage
commands =
  coverage combine
  coverage report
  coverage html
